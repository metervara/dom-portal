{"version":3,"file":"index.cjs","sources":["../src/DomPortal.ts","../src/portalRouter.ts","../src/portalLoader.ts","../src/portalLinks.ts","../src/setupDomPortal.ts","../src/index.ts"],"sourcesContent":["\ntype PortalState = \"closed\" | \"opening\" | \"open\" | \"closing\";\n\n// TODO: Might refactor...\n// TODO: With new set up, I only need two outer zones, one for left and one for right. Leave for now\nconst zones: string[] = [\n  \"top-left-outer\",\n  \"top-left-inner\",\n  \"top-right-outer\",\n  \"top-right-inner\",\n  \"bottom-left-outer\",\n  \"bottom-left-inner\",\n  \"bottom-right-outer\",\n  \"bottom-right-inner\",\n];\n\nexport class DomPortal {\n  // DOM references\n  private targetElement: HTMLElement;\n  private parentElement: HTMLElement | null;\n  private portalElement: HTMLElement | null = null; // Wrapper for the portal dom elements\n  // private holeElement: HTMLElement | null = null; // Hole element, where we place the content of the portal\n  // private holeLayers: HTMLElement[] = [];\n\n  // Geometry\n  private targetRect: DOMRect | undefined;\n  private parentRect: DOMRect | undefined;\n  private portalCenterX: number = 0;\n  private portalCenterY: number = 0;\n  private portalWidthOpenHalf: number = 0;\n\n  // State & animation\n  private state: PortalState = \"closed\";\n  // private transitionProgress: number = 0;\n  private animationFrameId: number | null = null;\n  private transitionTimeoutId: number | null = null;\n  private resizeObserver: ResizeObserver;\n  private handleGlobalPointerDown: (event: PointerEvent) => void;\n  // private handleWindowResize: () => void;\n\n  constructor(targetElement: HTMLElement) {\n    this.targetElement = targetElement;\n    this.parentElement = targetElement.parentElement; // IF NULL, error?\n\n    // Target parent must have relative position\n    const parentStyle = window.getComputedStyle(this.parentElement!);\n    const parentIsRelativeOrAbsolute =\n      parentStyle.position === \"relative\" ||\n      parentStyle.position === \"absolute\";\n    if (!parentIsRelativeOrAbsolute) {\n      console.error(\n        \"Dom portal only works if the parent of the target element is positioned relative or absolute\"\n      );\n      // TODO: Throw error?\n    }\n\n    this.resizeObserver = new ResizeObserver(() => {\n      if (this.state === \"closed\") return;\n\n      this.measureRects();\n\n      this.portalElement?.style.setProperty(\n        \"--clone-width\",\n        `${Math.round(this.targetRect!.width)}px`\n      );\n      this.portalElement?.style.setProperty(\n        \"--clone-height\",\n        `${Math.round(this.targetRect!.height)}px`\n      );\n    });\n    this.resizeObserver.observe(this.targetElement);\n\n    this.handleGlobalPointerDown = (event: PointerEvent) => {\n      if (this.state === \"closed\") return;\n\n      const target = event.target as HTMLElement;\n\n      // Keep portal open when interacting with the content container\n      if (target.closest(\".metervara-portal-content-container\")) {\n        return;\n      }\n\n      // Any other click while the portal is open closes it\n      this.closePortal(0, 0);\n    };\n\n    // Capture phase to ensure we see the click even if underlying elements handle it\n    document.addEventListener(\"pointerdown\", this.handleGlobalPointerDown, true);\n\n    // this.handleWindowResize = () => {\n    //   if (this.state === \"closed\") return;\n    //   this.closePortal(0, 0, { instant: true });\n    // };\n    // window.addEventListener(\"resize\", this.handleWindowResize);\n  }\n\n  /**\n   * Public methods\n   */\n  /**\n   * Open that ensures content container is ready for loading\n   */\n  public async openAndReady(\n    posX: number,\n    posY: number,\n    size?: string\n  ): Promise<HTMLElement> {\n    this.openPortal(posX, posY, size);\n\n    return new Promise((resolve, reject) => {\n      const check = () => {\n        const container = document.querySelector(\n          \".metervara-portal-content-container\"\n        ) as HTMLElement;\n        if (container) {\n          resolve(container);\n        } else if (this.state === \"closed\") {\n          reject(new Error(\"Portal closed before container was ready\"));\n        } else {\n          requestAnimationFrame(check);\n        }\n      };\n\n      requestAnimationFrame(check);\n    });\n  }\n\n  public openPortal(posX: number, posY: number, size?: string): void {\n    if (this.state !== \"closed\") return;\n\n    this.measureRects();\n\n    this.portalWidthOpenHalf = this.parseSize(size) * 0.5;\n    // this.portalWidthOpenHalfDiagonal = \n\n    // Reevaluate this. Should we just use whatever is passed in?\n    this.portalCenterX = posX - this.parentRect!.left;\n    this.portalCenterY = posY - this.parentRect!.top;\n\n    this.createPortalElements();\n\n    // Delay open, to ensure transition runs\n    requestAnimationFrame(() => {\n      this.open(); // Apply transition-triggering class here\n    });\n  }\n\n  public closePortal(\n    posX: number,\n    posY: number,\n    opts: { instant?: boolean } = {}\n  ): void {\n    if (this.state !== \"open\" && this.state !== \"opening\") return;\n\n    if (opts.instant) {\n      this.clearTransitionTimeout();\n      this.setState(\"closed\");\n      this.deletePortalElements();\n      return;\n    }\n\n    // If we are mid-opening, mark as open so the close animation can run\n    if (this.state === \"opening\") {\n      this.clearTransitionTimeout();\n      this.setState(\"open\");\n    }\n\n    this.close();\n  }\n\n  public togglePortal(posX: number, posY: number): void {\n    if (this.state === \"closed\") {\n      this.openPortal(posX, posY);\n    } else if (this.state === \"open\" || this.state === \"opening\") {\n      this.closePortal(posX, posY);\n    }\n  }\n\n  public destroy() {\n    this.resizeObserver.disconnect();\n    document.removeEventListener(\n      \"pointerdown\",\n      this.handleGlobalPointerDown,\n      true\n    );\n    // window.removeEventListener(\"resize\", this.handleWindowResize);\n\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    this.clearTransitionTimeout();\n    this.deletePortalElements();\n  }\n\n  /**\n   * Private methods - DOM utils\n   */\n  private parseSize(size?: string): number {\n    const defaultSize = this.parentRect!.width * 0.25;\n    if (!size) {\n      return defaultSize;\n    }\n\n    if (size.endsWith(\"px\")) {\n      return parseFloat(size);\n    } else if (size.endsWith(\"vw\")) {\n      const vw = parseFloat(size);\n      return (window.innerWidth * vw) / 100;\n    } else if (size.endsWith(\"vh\")) {\n      const vh = parseFloat(size);\n      return (window.innerHeight * vh) / 100;\n    }\n\n    return defaultSize;\n  }\n\n  private measureRects() {\n    this.parentRect = this.parentElement!.getBoundingClientRect();\n    this.targetRect = this.targetElement.getBoundingClientRect();\n\n    // Pick the size of the fully open portal\n    // this.portalWidthOpenHalf = this.parentRect.width * 0.25;\n  }\n\n  private createPortalElements(holeLayerCount: number = 1) {\n    this.portalElement = document.createElement(\"div\");\n    this.portalElement.classList.add(\"metervara-portal\");\n    this.parentElement?.appendChild(this.portalElement);\n\n    this.portalElement.style.setProperty(\n      \"--portal-center-x\",\n      `${Math.round(this.portalCenterX)}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--portal-center-y\",\n      `${Math.round(this.portalCenterY)}px`\n    );\n    // this.portalElement.style.setProperty(\"--portal-width\", \"0px\");\n    this.portalElement.style.setProperty(\n      \"--clone-width\",\n      `${Math.round(this.targetRect!.width)}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--clone-height\",\n      `${Math.round(this.targetRect!.height)}px`\n    );\n\n    const holeLayerWidth: number = 50;\n    this.portalElement.style.setProperty(\n      \"--hole-layer-width\",\n      `${holeLayerWidth}px`\n    ); // breakpoints?\n\n    this.portalElement.style.setProperty(\n      \"--portal-width-open-half\",\n      `${Math.round(this.portalWidthOpenHalf)}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--portal-width-inner-half\",\n      `${Math.round(this.portalWidthOpenHalf - holeLayerWidth * (holeLayerCount - 1))}px`\n    );\n\n    // ZONES \n    zones.forEach((id) => {\n      const zoneEl = document.createElement(\"div\");\n      zoneEl.classList.add(\"metervara-portal-zone\");\n      // zoneEl.classList.add(id); // TEMP\n      zoneEl.classList.add(...id.split(\"-\").map((a) => `zone-${a}`));\n\n      // CLONE\n      const cloneEl = this.targetElement.cloneNode(true) as HTMLElement;\n      cloneEl.classList.add(\"metervara-portal-clone\");\n\n      zoneEl.appendChild(cloneEl);\n      this.portalElement!.appendChild(zoneEl);\n    });\n\n    // HOLE BORDERS\n    const borderTop = document.createElement(\"div\");\n    borderTop.classList.add(\"metervara-portal-border\", \"top\");\n    this.portalElement!.appendChild(borderTop);\n\n    const borderBottom = document.createElement(\"div\");\n    borderBottom.classList.add(\"metervara-portal-border\", \"bottom\");\n    this.portalElement!.appendChild(borderBottom);\n    \n    // CONTENT CONTAINER\n    // Add content wrapper to the last hole layer\n    const contentWRapper = document.createElement(\"div\");\n    contentWRapper.classList.add(\"metervara-portal-content-container\");\n    this.portalElement!.appendChild(contentWRapper);\n\n    // Close when clicking anywhere on the portal except inside the content container\n    this.portalElement.addEventListener(\"pointerdown\", (event) => {\n      const target = event.target as HTMLElement;\n      if (target.closest(\".metervara-portal-content-container\")) return;\n      this.closePortal(0, 0);\n    });\n    \n\n    /*\n    // Add close button. Not sure about the visual of this one...\n    const closeButton = document.createElement('button');\n    closeButton.classList.add('metervara-portal-close-button');\n    closeButton.innerText = '+'; //Ã—'; // or use an icon\n\n    closeButton.addEventListener(\"click\", () => {\n      this.closePortal(0, 0);\n    });\n    this.holeLayers[this.holeLayers.length - 1].appendChild(closeButton);\n    */\n\n    \n  }\n\n  private deletePortalElements() {\n    if (this.portalElement) {\n      this.portalElement.innerHTML = \"\";\n      this.portalElement.remove();\n      this.portalElement = null;\n    }\n\n    // this.holeLayers.forEach((holeLayer) => {\n    //   holeLayer.innerHTML = \"\";\n    //   holeLayer.remove();\n    // });\n\n    // this.holeLayers = [];\n  }\n\n  /**\n   * Private methods - state & animation\n   */\n  private setState(state: PortalState) {\n    this.state = state;\n\n    const shouldHideTarget = state !== \"closed\";\n    this.targetElement.style.visibility = shouldHideTarget\n      ? \"hidden\"\n      : \"visible\";\n\n    const event = new CustomEvent(\"portal:\" + state, {\n      detail: {\n        portalElement: this.portalElement,\n        targetElement: this.targetElement,\n      },\n    });\n    window.dispatchEvent(event);\n  }\n\n  private open(duration = 750, stagger = 100) {\n    if (this.state !== \"closed\") return;\n    this.setState(\"opening\");\n    this.animateTransition(0, 1, duration, stagger, this.onOpened.bind(this));\n  }\n\n  private close(duration = 750, stagger = 100) {\n    if (this.state !== \"open\") return;\n    this.setState(\"closing\");\n    this.animateTransition(1, 0, duration, stagger, this.onClosed.bind(this));\n  }\n\n  private onOpened() {\n    this.setState(\"open\");\n  }\n\n  private onClosed() {\n    this.setState(\"closed\");\n    this.deletePortalElements();\n  }\n\n  /**\n   *\n   * @param from The starting value for the item beeing animated\n   * @param to  The end valeu for the item beeing animated (ms)\n   * @param duration duration of animation of single item (ms)\n   * @param stagger stagger delay if multiple holes\n   * @param onComplete\n   *\n   * // TODO: Fix ranges. using multiple ranges, normalized, staggered is less, and then we have the full...\n   * // TODO: Fix ranges. At the moment this might not work if from and to are not in the raneg 0 to 1\n   */\n  private animateTransition(\n    from: number,\n    to: number,\n    duration: number,\n    stagger: number,\n    onComplete: () => void\n  ) {\n    // const startTime = performance.now();\n    // const staggerItemCount = this.holeLayers.length;\n    // const totalDuration = duration + stagger * (staggerItemCount - 1);\n    // const normalizedStagger = stagger / totalDuration;\n    // const normalizedDuration = duration / totalDuration;\n\n    // DIRECT: Animate using css transition with this\n    if (to === 1) {\n      this.portalElement?.classList.add('open');\n    } else if (to === 0) {\n      this.portalElement?.classList.remove('open');\n    }\n\n    this.clearTransitionTimeout();\n    this.transitionTimeoutId = window.setTimeout(() => {\n      this.transitionTimeoutId = null;\n      onComplete();\n    }, duration);\n\n    /*\n    // JS Animation loop. \n    const animate = (currentTime: number) => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / totalDuration, 1); // easing.easeInOutCubic(Math.min(elapsed / totalDuration, 1)); // No easing yet...\n      \n      const value = from + (to - from) * progress; \n      \n      const staggeredProgress0 = easing.easeInOutCubic(getStaggeredTime(value, 0, normalizedStagger, normalizedDuration) / normalizedDuration); // 0 to 1\n      // debug.push(staggeredProgress0);\n\n      // this.portalElement?.style.setProperty('--portal-width', `${ this.transitionProgress * this.portalWidthOpenHalf}px`);\n      this.portalElement?.style.setProperty('--portal-width', `${ staggeredProgress0 * this.portalWidthOpenHalf}px`);\n\n      // Staggered progress for holes\n      this.holeLayers.forEach((hole, i) => {\n        const staggeredProgressIndex = easing.easeInOutCubic(getStaggeredTime(value, i, normalizedStagger, normalizedDuration) / normalizedDuration);\n        hole.style.setProperty('--portal-width', `${ staggeredProgressIndex * this.portalWidthOpenHalf}px`);\n      })\n\n      if (progress < 1) {\n        this.animationFrameId = requestAnimationFrame(animate);\n      } else {\n        onComplete();\n      }\n    };\n    this.animationFrameId = requestAnimationFrame(animate);\n    */\n  }\n\n  private clearTransitionTimeout() {\n    if (this.transitionTimeoutId !== null) {\n      clearTimeout(this.transitionTimeoutId);\n      this.transitionTimeoutId = null;\n    }\n  }\n}\n","type PortalRoute = {\n  page: string;\n  portal?: string;\n};\n\ntype PortalRouterOptions = {\n  mode?: 'query' | 'hash';\n  portalKey?: string;\n};\n\ntype PortalRouterCallback = (route: PortalRoute) => void;\n\nexport class PortalRouter {\n  private mode: 'query' | 'hash';\n  private key: string;\n  private callback?: PortalRouterCallback;\n\n  constructor(options: PortalRouterOptions = {}) {\n    this.mode = options.mode || 'query';\n    this.key = options.portalKey || 'portal';\n  }\n\n  public init(callback: PortalRouterCallback): void {\n    this.callback = callback;\n    window.addEventListener('popstate', () => this.handleRouteChange());\n    window.addEventListener('hashchange', () => this.handleRouteChange());\n    this.handleRouteChange();\n  }\n\n  private handleRouteChange() {\n    const route = this.getCurrentRoute();\n    this.callback?.(route);\n  }\n\n  public getCurrentRoute(): PortalRoute {\n    if (this.mode === 'hash') {\n      const [page, portal] = window.location.hash.slice(1).split('/');\n      return { page: page || '', portal };\n    } else {\n      const url = new URL(window.location.href);\n      return {\n        page: url.pathname.replace(/^\\/+/, ''),\n        portal: url.searchParams.get(this.key) || undefined\n      };\n    }\n  }\n\n  public open(portalName: string): void {\n    if (this.mode === 'hash') {\n      const { page } = this.getCurrentRoute();\n      window.location.hash = `${page}/${portalName}`;\n    } else {\n      const url = new URL(window.location.href);\n      url.searchParams.set(this.key, portalName);\n      history.pushState({}, '', url.toString());\n    }\n    this.handleRouteChange();\n  }\n\n  public close(): void {\n    if (this.mode === 'hash') {\n      const { page } = this.getCurrentRoute();\n      window.location.hash = `${page}/`;\n    } else {\n      const url = new URL(window.location.href);\n      url.searchParams.delete(this.key);\n      history.pushState({}, '', url.toString());\n    }\n    this.handleRouteChange();\n  }\n}\n","// Re-run <script> tags (especially needed for <script type=\"module\" src=\"...\">)\nfunction runScripts(element: HTMLElement) {\n  element.querySelectorAll(\"script\").forEach((oldScript) => {\n    const newScript = document.createElement(\"script\");\n    newScript.type = oldScript.type || \"text/javascript\";\n\n    console.log(oldScript)\n\n    if (oldScript.src) {\n      newScript.src = oldScript.src;\n    } else {\n      newScript.textContent = oldScript.textContent;\n    }\n\n    // Copy other attributes if needed (like async, defer)\n    oldScript.parentNode?.replaceChild(newScript, oldScript);\n  });\n}\n\ntype InlinePortalContentSource = {\n  type: \"inline\";\n  selector: string;\n  mode?: \"clone\" | \"move\";\n};\n\nexport type PortalContentSource =\n  | { type: \"html\"; path: string }\n  | { type: \"external\"; url: string }\n  | InlinePortalContentSource;\n\nfunction findPortalRegion(element: HTMLElement): HTMLElement | null {\n  if (element.dataset.portalRegion === \"main\") {\n    return element;\n  }\n  return element.querySelector('[data-portal-region=\"main\"]');\n}\n\nfunction stripIds(element: HTMLElement): void {\n  if (element.id) {\n    element.removeAttribute(\"id\");\n  }\n  element.querySelectorAll(\"[id]\").forEach((el) => {\n    el.removeAttribute(\"id\");\n  });\n}\n\ntype MovedInlineRegion = {\n  placeholder: Comment;\n  parent: Node;\n  wasHidden: boolean;\n  previousDisplay: string | null;\n};\n\nconst movedInlineRegions = new Map<HTMLElement, MovedInlineRegion>();\n\nfunction restoreMovedInlineRegions() {\n  for (const [region, info] of movedInlineRegions) {\n    const { placeholder, parent, wasHidden, previousDisplay } = info;\n\n    if (placeholder.parentNode) {\n      placeholder.parentNode.replaceChild(region, placeholder);\n    } else {\n      parent.appendChild(region);\n    }\n\n    if (wasHidden) {\n      region.setAttribute(\"hidden\", \"\");\n    } else {\n      region.removeAttribute(\"hidden\");\n    }\n\n    if (previousDisplay !== null) {\n      region.style.display = previousDisplay;\n    } else {\n      region.style.removeProperty(\"display\");\n    }\n\n    movedInlineRegions.delete(region);\n  }\n}\n\nexport async function loadPortalContent(\n  container: HTMLElement,\n  name: string,\n  source: PortalContentSource\n): Promise<void> {\n  restoreMovedInlineRegions();\n  container.innerHTML = \"\"; // clear existing content\n\n  if (source.type === \"inline\") {\n    const inlineElement = document.querySelector(source.selector) as HTMLElement | null;\n    if (!inlineElement) {\n      throw new Error(`Inline portal source \"${source.selector}\" not found`);\n    }\n\n    const region = findPortalRegion(inlineElement);\n    if (!region) {\n      throw new Error(`No content region found in inline source \"${source.selector}\"`);\n    }\n\n    const mode = source.mode || \"clone\";\n\n    if (mode === \"move\") {\n      const parent = region.parentNode;\n      if (!parent) {\n        throw new Error(`Inline portal source \"${source.selector}\" has no parent`);\n      }\n\n      const placeholder = document.createComment(\"portal-inline-placeholder\");\n      parent.insertBefore(placeholder, region);\n\n      const previousDisplay = region.style.display || null;\n      const wasHidden = region.hasAttribute(\"hidden\");\n\n      region.removeAttribute(\"hidden\");\n      region.style.removeProperty(\"display\");\n\n      movedInlineRegions.set(region, {\n        placeholder,\n        parent,\n        wasHidden,\n        previousDisplay,\n      });\n\n      container.appendChild(region);\n      return;\n    }\n\n    const clone = inlineElement.cloneNode(true) as HTMLElement;\n    clone.removeAttribute(\"hidden\");\n    clone.style.removeProperty(\"display\");\n    stripIds(clone);\n\n    const clonedRegion = findPortalRegion(clone);\n    if (!clonedRegion) {\n      throw new Error(`No content region found in inline source \"${source.selector}\"`);\n    }\n\n    container.appendChild(clonedRegion);\n    runScripts(clonedRegion);\n    return;\n  }\n\n  if (source.type === \"external\") {\n    const iframe = document.createElement(\"iframe\");\n    iframe.onload = () => {\n      iframe.classList.add(\"loaded\");\n    };\n    iframe.src = source.url;\n    iframe.allow = \"fullscreen; pointer-lock\"\n    \n    container.appendChild(iframe);\n    return;\n  }\n\n  // Handle local HTML file\n  const html = await fetch(source.path).then((res) => res.text());\n\n  const wrapper = document.createElement(\"div\");\n  wrapper.innerHTML = html;\n\n  const region = findPortalRegion(wrapper);\n  if (!region) throw new Error(`No content region found in ${source.path}`);\n\n  container.appendChild(region);\n  runScripts(region);\n\n  // Removed for now, also doens't work with js files in public folder\n  // Automatically infer JS module path based on HTML path\n  // const jsPath = source.path.replace(/\\.html$/, '.js');\n\n  // try {\n  //   const module: PortalModule = await import(/* @vite-ignore */ jsPath);\n  //   module?.init?.(region);\n  //   loadedModules[name] = { module, region };\n  // } catch (err) {\n  //   console.info(`No JS module found for \"${name}\" (optional):`, jsPath);\n  // }\n}\n\nexport function unloadPortalContent() {\n  restoreMovedInlineRegions();\n\n  const regions = document.querySelectorAll(\n    \".metervara-portal .metervara-portal-content-container [data-portal-region='main']\"\n  );\n\n  /*\n  console.log(\"unloading content in portal\", regions.length);\n  regions.forEach((region, index) => {\n    console.log(\"content parent\", index, region.parentElement);\n  });\n  */\n\n  regions.forEach((region) => region.remove());\n\n}\n","import { PortalRouter } from './portalRouter.js';\n\nexport function enhancePortalLinks(): void {\n  document.addEventListener(\"click\", (e) => {\n    const target = e.target as HTMLElement;\n    const link = target.closest('[data-portal]') as HTMLElement;\n\n\n    if (link) {\n      e.preventDefault();\n\n      const portalName = link.getAttribute('data-portal');\n      if (!portalName) return;\n\n      const path = link.getAttribute('data-portal-path');\n      const externalUrl = link.getAttribute('data-portal-url');\n      const inlineSelector = link.getAttribute('data-portal-inline');\n      const inlineMode = link.getAttribute('data-portal-inline-mode') as 'clone' | 'move' | null;\n\n      // Use actual mouse position\n      const clickX = e.clientX;\n      const clickY = e.clientY;\n\n      const size = link.getAttribute('data-portal-size') || undefined;\n\n      // Dispatch custom event that setupPortalSystem listens to\n      window.dispatchEvent(new CustomEvent('portal:trigger', {\n        detail: {\n          portalName,\n          clickX,\n          clickY,\n          path,\n          externalUrl,\n          inlineSelector,\n          inlineMode,\n          size,\n        }\n      }));\n    }\n  });\n}\n","import { DomPortal } from './DomPortal.js';\nimport { PortalRouter } from './portalRouter.js';\nimport { enhancePortalLinks } from './portalLinks.js';\nimport { loadPortalContent, unloadPortalContent } from './portalLoader.js';\n\ntype SetupOptions = {\n  routerMode?: 'query' | 'hash' | 'none';\n  portalTarget: string;\n};\n\nexport function setupDomPortal(options: SetupOptions) {\n  const targetElement = document.querySelector(options.portalTarget) as HTMLElement;\n  if (!targetElement) {\n    throw new Error(`Portal target \"${options.portalTarget}\" not found`);\n  }\n\n  const portal = new DomPortal(targetElement);\n  const routerMode = options.routerMode || 'query';\n  const router = routerMode === 'none' ? undefined : new PortalRouter({ mode: routerMode });\n  let suppressNextRoute = false;\n\n  enhancePortalLinks();\n\n  // Handle click-based opening\n  window.addEventListener('portal:trigger', async (e: any) => {\n    const {\n      portalName,\n      clickX,\n      clickY,\n      path,\n      externalUrl,\n      inlineSelector,\n      inlineMode,\n      size,\n      scrollIntoView = false\n    } = e.detail;\n    \n    try {\n      const container = await portal.openAndReady(clickX, clickY, size);\n      let source: Parameters<typeof loadPortalContent>[2];\n      if (inlineSelector) {\n        source = { type: 'inline', selector: inlineSelector, mode: inlineMode };\n      } else if (externalUrl) {\n        source = { type: 'external', url: externalUrl };\n      } else {\n        const resolvedPath = path || `/portal/content/${portalName}.html`;\n        source = { type: 'html', path: resolvedPath };\n      }\n\n      await loadPortalContent(container, portalName, source);\n\n      if (router) {\n        suppressNextRoute = true;\n        try {\n          router.open(portalName);\n        } finally {\n          suppressNextRoute = false;\n        }\n      }\n\n      if(scrollIntoView) {\n        window.scrollTo({\n          top: clickY - (window.innerHeight / 2),\n          behavior: 'smooth'\n        });\n      }\n    } catch (err) {\n      console.error('Portal failed to open:', err);\n    }\n\n  });\n\n  window.addEventListener('portal:closed', () => {\n    unloadPortalContent();\n\n    if (router) {\n      suppressNextRoute = true;\n      try {\n        router.close();\n      } finally {\n        suppressNextRoute = false;\n      }\n    }\n  });\n\n\n  // Handle routing (on load or URL change)\n  router?.init(async ({ portal: portalName }: { portal?: string }) => {\n    if (suppressNextRoute) return;\n\n    if (!portalName) {\n      portal.closePortal(0, 0);\n      return;\n    }\n  \n    const link = document.querySelector(`[data-portal=\"${portalName}\"]`) as HTMLElement;\n    if (!link) {\n      console.warn(`No portal link found for '${portalName}'`);\n      return;\n    }\n    const customPath = link?.getAttribute('data-portal-path');\n    const externalUrl = link?.getAttribute('data-portal-url');\n    const inlineSelector = link?.getAttribute('data-portal-inline');\n  \n    const rect = link?.getBoundingClientRect();\n    const x = rect.left + rect.width / 2;\n    const y = (rect.top + rect.height / 2) + window.scrollY; // Absolute from the top...\n    \n    const event = new CustomEvent('portal:trigger', {\n      detail: {\n        portalName,\n        clickX: x,\n        clickY: y,\n        path: customPath || (inlineSelector ? undefined : `/portal/content/${portalName}.html`),\n        externalUrl,\n        inlineSelector,\n        scrollIntoView: true,\n      },\n    });\n    \n    window.dispatchEvent(event);\n  });\n\n  return {\n    portal,\n    router,\n  };\n}\n","import \"./styles/portal.css\";\nimport \"./styles/content.css\";\n\nexport function hello(name: string) {\n  return `Hello, ${name}!`;\n}\n\nexport { DomPortal } from './DomPortal.js';\nexport { PortalRouter } from './portalRouter.js';\nexport { loadPortalContent, unloadPortalContent } from './portalLoader.js';\nexport type { PortalContentSource } from './portalLoader.js';\nexport { enhancePortalLinks } from './portalLinks.js';\nexport { setupDomPortal } from './setupDomPortal.js';"],"names":["zones","DomPortal","targetElement","parentStyle","event","posX","posY","size","resolve","reject","check","container","opts","defaultSize","vw","vh","holeLayerCount","holeLayerWidth","id","zoneEl","a","cloneEl","borderTop","borderBottom","contentWRapper","state","shouldHideTarget","duration","stagger","from","to","onComplete","PortalRouter","options","callback","route","page","portal","url","portalName","runScripts","element","oldScript","newScript","findPortalRegion","stripIds","el","movedInlineRegions","restoreMovedInlineRegions","region","info","placeholder","parent","wasHidden","previousDisplay","loadPortalContent","name","source","inlineElement","clone","clonedRegion","iframe","html","res","wrapper","unloadPortalContent","enhancePortalLinks","e","link","path","externalUrl","inlineSelector","inlineMode","clickX","clickY","setupDomPortal","routerMode","router","suppressNextRoute","scrollIntoView","err","customPath","rect","x","y","hello"],"mappings":"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"}