{"version":3,"file":"index.js","sources":["../src/DomPortal.ts","../src/portalRouter.ts","../src/portalLoader.ts","../src/portalLinks.ts","../src/setupDomPortal.ts","../src/index.ts"],"sourcesContent":["\ntype PortalState = \"closed\" | \"opening\" | \"open\" | \"closing\";\n\n// TODO: Might refactor...\n// TODO: With new set up, I only need two outer zones, one for left and one for right. Leave for now\nconst zones: string[] = [\n  \"top-left-outer\",\n  \"top-left-inner\",\n  \"top-right-outer\",\n  \"top-right-inner\",\n  \"bottom-left-outer\",\n  \"bottom-left-inner\",\n  \"bottom-right-outer\",\n  \"bottom-right-inner\",\n];\n\nexport class DomPortal {\n  // DOM references\n  private targetElement: HTMLElement;\n  private parentElement: HTMLElement | null;\n  private portalElement: HTMLElement | null = null; // Wrapper for the portal dom elements\n  // private holeElement: HTMLElement | null = null; // Hole element, where we place the content of the portal\n  // private holeLayers: HTMLElement[] = [];\n\n  // Geometry\n  private targetRect: DOMRect | undefined;\n  private parentRect: DOMRect | undefined;\n  private portalCenterX: number = 0;\n  private portalCenterY: number = 0;\n  private portalWidthOpenHalf: number = 0;\n\n  // State & animation\n  private state: PortalState = \"closed\";\n  // private transitionProgress: number = 0;\n  private animationFrameId: number | null = null;\n  private transitionTimeoutId: number | null = null;\n  private resizeObserver: ResizeObserver;\n  private handleGlobalPointerDown: (event: PointerEvent) => void;\n  private handleWindowResize: () => void;\n\n  constructor(targetElement: HTMLElement) {\n    this.targetElement = targetElement;\n    this.parentElement = targetElement.parentElement; // IF NULL, error?\n\n    // Target parent must have relative position\n    const parentStyle = window.getComputedStyle(this.parentElement!);\n    const parentIsRelativeOrAbsolute =\n      parentStyle.position === \"relative\" ||\n      parentStyle.position === \"absolute\";\n    if (!parentIsRelativeOrAbsolute) {\n      console.error(\n        \"Dom portal only works if the parent of the target element is positioned relative or absolute\"\n      );\n      // TODO: Throw error?\n    }\n\n    this.resizeObserver = new ResizeObserver(() => {\n      if (this.state === \"closed\") return;\n\n      this.measureRects();\n\n      this.portalElement?.style.setProperty(\n        \"--clone-width\",\n        `${this.targetRect!.width}px`\n      );\n      this.portalElement?.style.setProperty(\n        \"--clone-height\",\n        `${this.targetRect!.height}px`\n      );\n    });\n    this.resizeObserver.observe(this.targetElement);\n\n    this.handleGlobalPointerDown = (event: PointerEvent) => {\n      if (this.state === \"closed\") return;\n\n      const target = event.target as HTMLElement;\n\n      // Keep portal open when interacting with the content container\n      if (target.closest(\".metervara-portal-content-container\")) {\n        return;\n      }\n\n      // Any other click while the portal is open closes it\n      this.closePortal(0, 0);\n    };\n\n    // Capture phase to ensure we see the click even if underlying elements handle it\n    document.addEventListener(\"pointerdown\", this.handleGlobalPointerDown, true);\n\n    this.handleWindowResize = () => {\n      if (this.state === \"closed\") return;\n      this.closePortal(0, 0, { instant: true });\n    };\n\n    window.addEventListener(\"resize\", this.handleWindowResize);\n  }\n\n  /**\n   * Public methods\n   */\n  /**\n   * Open that ensures content container is ready for loading\n   */\n  public async openAndReady(\n    posX: number,\n    posY: number,\n    size?: string\n  ): Promise<HTMLElement> {\n    this.openPortal(posX, posY, size);\n\n    return new Promise((resolve, reject) => {\n      const check = () => {\n        const container = document.querySelector(\n          \".metervara-portal-content-container\"\n        ) as HTMLElement;\n        if (container) {\n          resolve(container);\n        } else if (this.state === \"closed\") {\n          reject(new Error(\"Portal closed before container was ready\"));\n        } else {\n          requestAnimationFrame(check);\n        }\n      };\n\n      requestAnimationFrame(check);\n    });\n  }\n\n  public openPortal(posX: number, posY: number, size?: string): void {\n    if (this.state !== \"closed\") return;\n\n    this.measureRects();\n\n    this.portalWidthOpenHalf = this.parseSize(size) * 0.5;\n    // this.portalWidthOpenHalfDiagonal = \n\n    // Reevaluate this. Should we just use whatever is passed in?\n    this.portalCenterX = posX - this.parentRect!.left;\n    this.portalCenterY = posY - this.parentRect!.top;\n\n    this.createPortalElements();\n\n    // Delay open, to ensure transition runs\n    requestAnimationFrame(() => {\n      this.open(); // Apply transition-triggering class here\n    });\n  }\n\n  public closePortal(\n    posX: number,\n    posY: number,\n    opts: { instant?: boolean } = {}\n  ): void {\n    if (this.state !== \"open\" && this.state !== \"opening\") return;\n\n    if (opts.instant) {\n      this.clearTransitionTimeout();\n      this.setState(\"closed\");\n      this.deletePortalElements();\n      return;\n    }\n\n    // If we are mid-opening, mark as open so the close animation can run\n    if (this.state === \"opening\") {\n      this.clearTransitionTimeout();\n      this.setState(\"open\");\n    }\n\n    this.close();\n  }\n\n  public togglePortal(posX: number, posY: number): void {\n    if (this.state === \"closed\") {\n      this.openPortal(posX, posY);\n    } else if (this.state === \"open\" || this.state === \"opening\") {\n      this.closePortal(posX, posY);\n    }\n  }\n\n  public destroy() {\n    this.resizeObserver.disconnect();\n    document.removeEventListener(\n      \"pointerdown\",\n      this.handleGlobalPointerDown,\n      true\n    );\n    window.removeEventListener(\"resize\", this.handleWindowResize);\n\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n    }\n    this.clearTransitionTimeout();\n    this.deletePortalElements();\n  }\n\n  /**\n   * Private methods - DOM utils\n   */\n  private parseSize(size?: string): number {\n    const defaultSize = this.parentRect!.width * 0.25;\n    if (!size) {\n      return defaultSize;\n    }\n\n    if (size.endsWith(\"px\")) {\n      return parseFloat(size);\n    } else if (size.endsWith(\"vw\")) {\n      const vw = parseFloat(size);\n      return (window.innerWidth * vw) / 100;\n    } else if (size.endsWith(\"vh\")) {\n      const vh = parseFloat(size);\n      return (window.innerHeight * vh) / 100;\n    }\n\n    return defaultSize;\n  }\n\n  private measureRects() {\n    this.parentRect = this.parentElement!.getBoundingClientRect();\n    this.targetRect = this.targetElement.getBoundingClientRect();\n\n    // Pick the size of the fully open portal\n    // this.portalWidthOpenHalf = this.parentRect.width * 0.25;\n  }\n\n  private createPortalElements(holeLayerCount: number = 1) {\n    this.portalElement = document.createElement(\"div\");\n    this.portalElement.classList.add(\"metervara-portal\");\n    this.parentElement?.appendChild(this.portalElement);\n\n    this.portalElement.style.setProperty(\n      \"--portal-center-x\",\n      `${Math.round(this.portalCenterX)}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--portal-center-y\",\n      `${Math.round(this.portalCenterY)}px`\n    );\n    // this.portalElement.style.setProperty(\"--portal-width\", \"0px\");\n    this.portalElement.style.setProperty(\n      \"--clone-width\",\n      `${this.targetRect!.width}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--clone-height\",\n      `${this.targetRect!.height}px`\n    );\n\n    const holeLayerWidth: number = 50;\n    this.portalElement.style.setProperty(\n      \"--hole-layer-width\",\n      `${holeLayerWidth}px`\n    ); // breakpoints?\n\n    this.portalElement.style.setProperty(\n      \"--portal-width-open-half\",\n      `${this.portalWidthOpenHalf}px`\n    );\n    this.portalElement.style.setProperty(\n      \"--portal-width-inner-half\",\n      `${this.portalWidthOpenHalf - holeLayerWidth * (holeLayerCount - 1)}px`\n    );\n\n    // ZONES \n    zones.forEach((id) => {\n      const zoneEl = document.createElement(\"div\");\n      zoneEl.classList.add(\"metervara-portal-zone\");\n      // zoneEl.classList.add(id); // TEMP\n      zoneEl.classList.add(...id.split(\"-\").map((a) => `zone-${a}`));\n\n      // CLONE\n      const cloneEl = this.targetElement.cloneNode(true) as HTMLElement;\n      cloneEl.classList.add(\"metervara-portal-clone\");\n\n      zoneEl.appendChild(cloneEl);\n      this.portalElement!.appendChild(zoneEl);\n    });\n\n    // HOLE BORDERS\n    const borderTop = document.createElement(\"div\");\n    borderTop.classList.add(\"metervara-portal-border\", \"top\");\n    this.portalElement!.appendChild(borderTop);\n\n    const borderBottom = document.createElement(\"div\");\n    borderBottom.classList.add(\"metervara-portal-border\", \"bottom\");\n    this.portalElement!.appendChild(borderBottom);\n    \n    // CONTENT CONTAINER\n    // Add content wrapper to the last hole layer\n    const contentWRapper = document.createElement(\"div\");\n    contentWRapper.classList.add(\"metervara-portal-content-container\");\n    this.portalElement!.appendChild(contentWRapper);\n\n    // Close when clicking anywhere on the portal except inside the content container\n    this.portalElement.addEventListener(\"pointerdown\", (event) => {\n      const target = event.target as HTMLElement;\n      if (target.closest(\".metervara-portal-content-container\")) return;\n      this.closePortal(0, 0);\n    });\n    \n\n    /*\n    // Add close button. Not sure about the visual of this one...\n    const closeButton = document.createElement('button');\n    closeButton.classList.add('metervara-portal-close-button');\n    closeButton.innerText = '+'; //Ã—'; // or use an icon\n\n    closeButton.addEventListener(\"click\", () => {\n      this.closePortal(0, 0);\n    });\n    this.holeLayers[this.holeLayers.length - 1].appendChild(closeButton);\n    */\n\n    \n  }\n\n  private deletePortalElements() {\n    if (this.portalElement) {\n      this.portalElement.innerHTML = \"\";\n      this.portalElement.remove();\n      this.portalElement = null;\n    }\n\n    // this.holeLayers.forEach((holeLayer) => {\n    //   holeLayer.innerHTML = \"\";\n    //   holeLayer.remove();\n    // });\n\n    // this.holeLayers = [];\n  }\n\n  /**\n   * Private methods - state & animation\n   */\n  private setState(state: PortalState) {\n    this.state = state;\n\n    const shouldHideTarget = state !== \"closed\";\n    this.targetElement.style.visibility = shouldHideTarget\n      ? \"hidden\"\n      : \"visible\";\n\n    const event = new CustomEvent(\"portal:\" + state, {\n      detail: {\n        portalElement: this.portalElement,\n        targetElement: this.targetElement,\n      },\n    });\n    window.dispatchEvent(event);\n  }\n\n  private open(duration = 750, stagger = 100) {\n    if (this.state !== \"closed\") return;\n    this.setState(\"opening\");\n    this.animateTransition(0, 1, duration, stagger, this.onOpened.bind(this));\n  }\n\n  private close(duration = 750, stagger = 100) {\n    if (this.state !== \"open\") return;\n    this.setState(\"closing\");\n    this.animateTransition(1, 0, duration, stagger, this.onClosed.bind(this));\n  }\n\n  private onOpened() {\n    this.setState(\"open\");\n  }\n\n  private onClosed() {\n    this.setState(\"closed\");\n    this.deletePortalElements();\n  }\n\n  /**\n   *\n   * @param from The starting value for the item beeing animated\n   * @param to  The end valeu for the item beeing animated (ms)\n   * @param duration duration of animation of single item (ms)\n   * @param stagger stagger delay if multiple holes\n   * @param onComplete\n   *\n   * // TODO: Fix ranges. using multiple ranges, normalized, staggered is less, and then we have the full...\n   * // TODO: Fix ranges. At the moment this might not work if from and to are not in the raneg 0 to 1\n   */\n  private animateTransition(\n    from: number,\n    to: number,\n    duration: number,\n    stagger: number,\n    onComplete: () => void\n  ) {\n    // const startTime = performance.now();\n    // const staggerItemCount = this.holeLayers.length;\n    // const totalDuration = duration + stagger * (staggerItemCount - 1);\n    // const normalizedStagger = stagger / totalDuration;\n    // const normalizedDuration = duration / totalDuration;\n\n    // DIRECT: Animate using css transition with this\n    if (to === 1) {\n      this.portalElement?.classList.add('open');\n    } else if (to === 0) {\n      this.portalElement?.classList.remove('open');\n    }\n\n    this.clearTransitionTimeout();\n    this.transitionTimeoutId = window.setTimeout(() => {\n      this.transitionTimeoutId = null;\n      onComplete();\n    }, duration);\n\n    /*\n    // JS Animation loop. \n    const animate = (currentTime: number) => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / totalDuration, 1); // easing.easeInOutCubic(Math.min(elapsed / totalDuration, 1)); // No easing yet...\n      \n      const value = from + (to - from) * progress; \n      \n      const staggeredProgress0 = easing.easeInOutCubic(getStaggeredTime(value, 0, normalizedStagger, normalizedDuration) / normalizedDuration); // 0 to 1\n      // debug.push(staggeredProgress0);\n\n      // this.portalElement?.style.setProperty('--portal-width', `${ this.transitionProgress * this.portalWidthOpenHalf}px`);\n      this.portalElement?.style.setProperty('--portal-width', `${ staggeredProgress0 * this.portalWidthOpenHalf}px`);\n\n      // Staggered progress for holes\n      this.holeLayers.forEach((hole, i) => {\n        const staggeredProgressIndex = easing.easeInOutCubic(getStaggeredTime(value, i, normalizedStagger, normalizedDuration) / normalizedDuration);\n        hole.style.setProperty('--portal-width', `${ staggeredProgressIndex * this.portalWidthOpenHalf}px`);\n      })\n\n      if (progress < 1) {\n        this.animationFrameId = requestAnimationFrame(animate);\n      } else {\n        onComplete();\n      }\n    };\n    this.animationFrameId = requestAnimationFrame(animate);\n    */\n  }\n\n  private clearTransitionTimeout() {\n    if (this.transitionTimeoutId !== null) {\n      clearTimeout(this.transitionTimeoutId);\n      this.transitionTimeoutId = null;\n    }\n  }\n}\n","type PortalRoute = {\n  page: string;\n  portal?: string;\n};\n\ntype PortalRouterOptions = {\n  mode?: 'query' | 'hash';\n  portalKey?: string;\n};\n\ntype PortalRouterCallback = (route: PortalRoute) => void;\n\nexport class PortalRouter {\n  private mode: 'query' | 'hash';\n  private key: string;\n  private callback?: PortalRouterCallback;\n\n  constructor(options: PortalRouterOptions = {}) {\n    this.mode = options.mode || 'query';\n    this.key = options.portalKey || 'portal';\n  }\n\n  public init(callback: PortalRouterCallback): void {\n    this.callback = callback;\n    window.addEventListener('popstate', () => this.handleRouteChange());\n    window.addEventListener('hashchange', () => this.handleRouteChange());\n    this.handleRouteChange();\n  }\n\n  private handleRouteChange() {\n    const route = this.getCurrentRoute();\n    this.callback?.(route);\n  }\n\n  public getCurrentRoute(): PortalRoute {\n    if (this.mode === 'hash') {\n      const [page, portal] = window.location.hash.slice(1).split('/');\n      return { page: page || '', portal };\n    } else {\n      const url = new URL(window.location.href);\n      return {\n        page: url.pathname.replace(/^\\/+/, ''),\n        portal: url.searchParams.get(this.key) || undefined\n      };\n    }\n  }\n\n  public open(portalName: string): void {\n    if (this.mode === 'hash') {\n      const { page } = this.getCurrentRoute();\n      window.location.hash = `${page}/${portalName}`;\n    } else {\n      const url = new URL(window.location.href);\n      url.searchParams.set(this.key, portalName);\n      history.pushState({}, '', url.toString());\n    }\n    this.handleRouteChange();\n  }\n\n  public close(): void {\n    if (this.mode === 'hash') {\n      const { page } = this.getCurrentRoute();\n      window.location.hash = `${page}/`;\n    } else {\n      const url = new URL(window.location.href);\n      url.searchParams.delete(this.key);\n      history.pushState({}, '', url.toString());\n    }\n    this.handleRouteChange();\n  }\n}\n","// Re-run <script> tags (especially needed for <script type=\"module\" src=\"...\">)\nfunction runScripts(element: HTMLElement) {\n  element.querySelectorAll(\"script\").forEach((oldScript) => {\n    const newScript = document.createElement(\"script\");\n    newScript.type = oldScript.type || \"text/javascript\";\n\n    console.log(oldScript)\n\n    if (oldScript.src) {\n      newScript.src = oldScript.src;\n    } else {\n      newScript.textContent = oldScript.textContent;\n    }\n\n    // Copy other attributes if needed (like async, defer)\n    oldScript.parentNode?.replaceChild(newScript, oldScript);\n  });\n}\n\nexport type PortalContentSource =\n  | { type: \"html\"; path: string }\n  | { type: \"external\"; url: string }\n  | { type: \"inline\"; selector: string };\n\nfunction findPortalRegion(element: HTMLElement): HTMLElement | null {\n  if (element.dataset.portalRegion === \"main\") {\n    return element;\n  }\n  return element.querySelector('[data-portal-region=\"main\"]');\n}\n\nexport async function loadPortalContent(\n  container: HTMLElement,\n  name: string,\n  source: PortalContentSource\n): Promise<void> {\n  container.innerHTML = \"\"; // clear existing content\n\n  if (source.type === \"inline\") {\n    const inlineElement = document.querySelector(source.selector) as\n      | HTMLElement\n      | null;\n    if (!inlineElement) {\n      throw new Error(`Inline portal source \"${source.selector}\" not found`);\n    }\n\n    const clone = inlineElement.cloneNode(true) as HTMLElement;\n    clone.removeAttribute(\"hidden\");\n    clone.style.removeProperty(\"display\");\n\n    const region = findPortalRegion(clone);\n    if (!region) {\n      throw new Error(\n        `No content region found in inline source \"${source.selector}\"`\n      );\n    }\n\n    container.appendChild(region);\n    runScripts(region);\n    return;\n  }\n\n  if (source.type === \"external\") {\n    const iframe = document.createElement(\"iframe\");\n    iframe.onload = () => {\n      iframe.classList.add(\"loaded\");\n    };\n    iframe.src = source.url;\n    iframe.allow = \"fullscreen; pointer-lock\"\n    \n    container.appendChild(iframe);\n    return;\n  }\n\n  // Handle local HTML file\n  const html = await fetch(source.path).then((res) => res.text());\n\n  const wrapper = document.createElement(\"div\");\n  wrapper.innerHTML = html;\n\n  const region = findPortalRegion(wrapper);\n  if (!region) throw new Error(`No content region found in ${source.path}`);\n\n  container.appendChild(region);\n  runScripts(region);\n\n  // Removed for now, also doens't work with js files in public folder\n  // Automatically infer JS module path based on HTML path\n  // const jsPath = source.path.replace(/\\.html$/, '.js');\n\n  // try {\n  //   const module: PortalModule = await import(/* @vite-ignore */ jsPath);\n  //   module?.init?.(region);\n  //   loadedModules[name] = { module, region };\n  // } catch (err) {\n  //   console.info(`No JS module found for \"${name}\" (optional):`, jsPath);\n  // }\n}\n\nexport function unloadPortalContent() {\n  const regions = document.querySelectorAll(\n    \".metervara-portal .metervara-portal-content-container [data-portal-region='main']\"\n  );\n\n  /*\n  console.log(\"unloading content in portal\", regions.length);\n  regions.forEach((region, index) => {\n    console.log(\"content parent\", index, region.parentElement);\n  });\n  */\n\n  regions.forEach((region) => region.remove());\n\n}\n","import { PortalRouter } from './portalRouter.js';\n\nexport function enhancePortalLinks(): void {\n  document.addEventListener(\"click\", (e) => {\n    const target = e.target as HTMLElement;\n    const link = target.closest('[data-portal]') as HTMLElement;\n\n\n    if (link) {\n      e.preventDefault();\n\n      const portalName = link.getAttribute('data-portal');\n      if (!portalName) return;\n\n      const path = link.getAttribute('data-portal-path');\n      const externalUrl = link.getAttribute('data-portal-url');\n      const inlineSelector = link.getAttribute('data-portal-inline');\n\n      // Use actual mouse position\n      const clickX = e.clientX;\n      const clickY = e.clientY;\n\n      const size = link.getAttribute('data-portal-size') || undefined;\n\n      // Dispatch custom event that setupPortalSystem listens to\n      window.dispatchEvent(new CustomEvent('portal:trigger', {\n        detail: {\n          portalName,\n          clickX,\n          clickY,\n          path,\n          externalUrl,\n          inlineSelector,\n          size,\n        }\n      }));\n    }\n  });\n}\n","import { DomPortal } from './DomPortal.js';\nimport { PortalRouter } from './portalRouter.js';\nimport { enhancePortalLinks } from './portalLinks.js';\nimport { loadPortalContent, unloadPortalContent } from './portalLoader.js';\n\ntype SetupOptions = {\n  routerMode?: 'query' | 'hash' | 'none';\n  portalTarget: string;\n};\n\nexport function setupDomPortal(options: SetupOptions) {\n  const targetElement = document.querySelector(options.portalTarget) as HTMLElement;\n  if (!targetElement) {\n    throw new Error(`Portal target \"${options.portalTarget}\" not found`);\n  }\n\n  const portal = new DomPortal(targetElement);\n  const routerMode = options.routerMode || 'query';\n  const router = routerMode === 'none' ? undefined : new PortalRouter({ mode: routerMode });\n  let suppressNextRoute = false;\n\n  enhancePortalLinks();\n\n  // Handle click-based opening\n  window.addEventListener('portal:trigger', async (e: any) => {\n    const {\n      portalName,\n      clickX,\n      clickY,\n      path,\n      externalUrl,\n      inlineSelector,\n      size,\n      scrollIntoView = false\n    } = e.detail;\n    \n    try {\n      const container = await portal.openAndReady(clickX, clickY, size);\n      let source: Parameters<typeof loadPortalContent>[2];\n      if (inlineSelector) {\n        source = { type: 'inline', selector: inlineSelector };\n      } else if (externalUrl) {\n        source = { type: 'external', url: externalUrl };\n      } else {\n        const resolvedPath = path || `/portal/content/${portalName}.html`;\n        source = { type: 'html', path: resolvedPath };\n      }\n\n      await loadPortalContent(container, portalName, source);\n\n      if (router) {\n        suppressNextRoute = true;\n        try {\n          router.open(portalName);\n        } finally {\n          suppressNextRoute = false;\n        }\n      }\n\n      if(scrollIntoView) {\n        window.scrollTo({\n          top: clickY - (window.innerHeight / 2),\n          behavior: 'smooth'\n        });\n      }\n    } catch (err) {\n      console.error('Portal failed to open:', err);\n    }\n\n  });\n\n  window.addEventListener('portal:closed', () => {\n    unloadPortalContent();\n\n    if (router) {\n      suppressNextRoute = true;\n      try {\n        router.close();\n      } finally {\n        suppressNextRoute = false;\n      }\n    }\n  });\n\n\n  // Handle routing (on load or URL change)\n  router?.init(async ({ portal: portalName }: { portal?: string }) => {\n    if (suppressNextRoute) return;\n\n    if (!portalName) {\n      portal.closePortal(0, 0);\n      return;\n    }\n  \n    const link = document.querySelector(`[data-portal=\"${portalName}\"]`) as HTMLElement;\n    if (!link) {\n      console.warn(`No portal link found for '${portalName}'`);\n      return;\n    }\n    const customPath = link?.getAttribute('data-portal-path');\n    const externalUrl = link?.getAttribute('data-portal-url');\n    const inlineSelector = link?.getAttribute('data-portal-inline');\n  \n    const rect = link?.getBoundingClientRect();\n    const x = rect.left + rect.width / 2;\n    const y = (rect.top + rect.height / 2) + window.scrollY; // Absolute from the top...\n    \n    const event = new CustomEvent('portal:trigger', {\n      detail: {\n        portalName,\n        clickX: x,\n        clickY: y,\n        path: customPath || (inlineSelector ? undefined : `/portal/content/${portalName}.html`),\n        externalUrl,\n        inlineSelector,\n        scrollIntoView: true,\n      },\n    });\n    \n    window.dispatchEvent(event);\n  });\n\n  return {\n    portal,\n    router,\n  };\n}\n","import \"./styles/portal.css\";\nimport \"./styles/content.css\";\n\nexport function hello(name: string) {\n  return `Hello, ${name}!`;\n}\n\nexport { DomPortal } from './DomPortal.js';\nexport { PortalRouter } from './portalRouter.js';\nexport { loadPortalContent, unloadPortalContent } from './portalLoader.js';\nexport type { PortalContentSource } from './portalLoader.js';\nexport { enhancePortalLinks } from './portalLinks.js';\nexport { setupDomPortal } from './setupDomPortal.js';"],"names":["zones","DomPortal","targetElement","parentStyle","event","posX","posY","size","resolve","reject","check","container","opts","defaultSize","vw","vh","holeLayerCount","holeLayerWidth","id","zoneEl","a","cloneEl","borderTop","borderBottom","contentWRapper","state","shouldHideTarget","duration","stagger","from","to","onComplete","PortalRouter","options","callback","route","page","portal","url","portalName","runScripts","element","oldScript","newScript","findPortalRegion","loadPortalContent","name","source","inlineElement","clone","region","iframe","html","res","wrapper","unloadPortalContent","enhancePortalLinks","e","link","path","externalUrl","inlineSelector","clickX","clickY","setupDomPortal","routerMode","router","suppressNextRoute","scrollIntoView","err","customPath","rect","x","y","hello"],"mappings":"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"}